(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5022],{9086:(e,t,a)=>{"use strict";a.d(t,{Dc:()=>r.Dc,Gz:()=>u,Nn:()=>d,_L:()=>p,lU:()=>c,ui:()=>i});var r=a(35317),s=a(70412);let l={USERS:"users",COMPANIES:"companies",EMPLOYEES:"employees",JOB_POSITIONS:"jobPositions",SELECTION_PROCESSES:"selectionProcesses",PAYROLLS:"payrolls",ATTENDANCES:"attendances",DOCUMENTS:"documents"},o=e=>(0,r.rJ)(s.db,l[e]),n=(e,t)=>(0,r.H9)(s.db,l[e],t),i=async(e,t)=>{let a=r.Dc.now();return await (0,r.gS)(o(e),{...t,createdAt:a,updatedAt:a})},c=async(e,t,a)=>await (0,r.mZ)(n(e,t),{...a,updatedAt:r.Dc.now()}),d=async(e,t)=>await (0,r.kd)(n(e,t)),u=async(e,t)=>{let a=(0,r.P)(o(e),...t);return(await (0,r.GG)(a)).docs.map(e=>({id:e.id,...e.data()}))},p=async(e,t)=>{let a=await (0,r.x7)(n(e,t));return a.exists()?{id:a.id,...a.data()}:null}},19053:(e,t,a)=>{"use strict";a.d(t,{O:()=>i});var r=a(95155),s=a(12115),l=a(35695),o=a(40283),n=a(50172);let i=e=>{let{children:t,allowedRoles:a}=e,{user:i,loading:c}=(0,o.A)(),d=(0,l.useRouter)();return((0,s.useEffect)(()=>{if(!c){if(!i)return void d.push("/");if(a&&!a.includes(i.role))return void d.push("/dashboard")}},[i,c,d,a]),c)?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,r.jsx)(n.A,{className:"h-8 w-8 animate-spin"})}):i&&(!a||a.includes(i.role))?(0,r.jsx)(r.Fragment,{children:t}):null}},57460:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>L});var r=a(95155),s=a(12115),l=a(15300),o=a(37648),n=a(88390),i=a(50286),c=a(68718),d=a(30285),u=a(66695),p=a(85057),m=a(62523),h=a(59409),x=a(26126),v=a(19053),y=a(87481),g=a(40283),f=a(26597),w=a(52699),j=a.n(w),D=a(85053),N=a(85427),E=a(62387),b=a(9086);let S=async(e,t)=>{let{companyId:a,startDate:r,endDate:s}=t;try{switch(e){case"attendance":return await A(t);case"payroll":return await k(t);case"employees":return await R(t);case"overview":return await C(t);default:throw Error("Tipo de reporte no v\xe1lido")}}catch(e){throw console.error("Error generating report data:",e),e}};async function A(e){let{companyId:t,startDate:a,endDate:r}=e,s=await (0,D.n8)(t,a,r);return{type:"attendance",data:{attendances:s,stats:await (0,D.vY)(t,a,r),totalRecords:s.length,dateRange:{startDate:a,endDate:r},chartData:s.map(e=>({date:e.date instanceof b.Dc?e.date.toDate().toISOString().split("T")[0]:"N/A",status:e.status,hours:e.totalHours||0}))},generatedAt:new Date,filters:e}}async function k(e){let{companyId:t}=e,a=await (0,N.rI)(t),r=await (0,E.uc)(t),s=a.reduce((e,t)=>e+t.totalGross,0),l=a.reduce((e,t)=>e+t.totalNet,0);return{type:"payroll",data:{payrolls:a,employees:r,totalGross:s,totalNet:l,averageSalary:a.length>0?l/a.length:0,chartData:a.map(e=>{var t;return{employee:(null==(t=r.find(t=>t.id===e.employeeId))?void 0:t.name)||"Desconocido",grossSalary:e.totalGross,netSalary:e.totalNet}})},generatedAt:new Date,filters:e}}async function R(e){let{companyId:t}=e,a=await (0,E.uc)(t),r=a.reduce((e,t)=>{let a=t.department||"Sin departamento";return e[a]||(e[a]=[]),e[a].push(t),e},{});return{type:"employees",data:{employees:a,totalEmployees:a.length,activeEmployees:a.filter(e=>"activo"===e.status).length,departmentGroups:r,chartData:Object.entries(r).map(e=>{let[t,a]=e;return{department:t,count:a.length}})},generatedAt:new Date,filters:e}}async function C(e){let{companyId:t,startDate:a,endDate:r}=e,[s,l,o]=await Promise.all([(0,E.uc)(t),(0,D.n8)(t,a,r),(0,N.rI)(t)]),n=await (0,D.vY)(t,a,r);return{type:"overview",data:{overview:{totalEmployees:s.length,activeEmployees:s.filter(e=>"activo"===e.status).length,totalAttendances:l.length,averageHours:n.averageHours,totalPayroll:o.reduce((e,t)=>e+t.totalNet,0),attendanceRate:l.length/s.length*100},employees:s,attendances:l,payrolls:o,stats:n},generatedAt:new Date,filters:e}}let I=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reporte.pdf";try{let a=document.getElementById(e);if(!a)throw Error("Elemento no encontrado para generar PDF");let r=await j()(a,{scale:2,useCORS:!0,allowTaint:!0}),s=r.toDataURL("image/png"),l=new f.Ay,o=l.internal.pageSize.height,n=190*r.height/r.width,i=n,c=10;for(l.addImage(s,"PNG",10,c,190,n),i-=o;i>=0;)c=i-n,l.addPage(),l.addImage(s,"PNG",10,c,190,n),i-=o;l.save(t)}catch(e){throw console.error("Error generating PDF:",e),e}},O=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"reporte.csv";if(!e.length)return;let a=Object.keys(e[0]),r=new Blob([[a.join(","),...e.map(e=>a.map(t=>{let a=e[t];return"string"==typeof a&&a.includes(",")?'"'.concat(a,'"'):a}).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){let e=URL.createObjectURL(r);s.setAttribute("href",e),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},T=()=>{let[e,t]=(0,s.useState)(!1),[a,r]=(0,s.useState)(null),{user:l}=(0,g.A)(),o=(0,s.useCallback)(async(e,a)=>{if(!(null==l?void 0:l.companyId))return void(0,y.oR)({title:"Error",description:"No se encontr\xf3 la informaci\xf3n de la empresa",variant:"destructive"});t(!0);try{let t=await S(e,{...a,companyId:l.companyId});r(t),(0,y.oR)({title:"Reporte generado",description:"El reporte se ha generado correctamente"})}catch(e){console.error("Error generating report:",e),(0,y.oR)({title:"Error",description:"Error al generar el reporte",variant:"destructive"})}finally{t(!1)}},[null==l?void 0:l.companyId]),n=(0,s.useCallback)(async(e,r)=>{if(!a)return void(0,y.oR)({title:"Error",description:"No hay reporte para exportar",variant:"destructive"});t(!0);try{await I(e,r),(0,y.oR)({title:"PDF exportado",description:"El reporte se ha exportado correctamente"})}catch(e){console.error("Error exporting PDF:",e),(0,y.oR)({title:"Error",description:"Error al exportar el PDF",variant:"destructive"})}finally{t(!1)}},[a]),i=(0,s.useCallback)(e=>{if(!(null==a?void 0:a.data))return void(0,y.oR)({title:"Error",description:"No hay datos para exportar",variant:"destructive"});try{let t=[];"attendance"===a.type&&a.data.attendances?t=a.data.attendances.map(e=>({fecha:e.date,empleado:e.employeeName||"N/A",estado:e.status,horas:e.totalHours||0})):"payroll"===a.type&&a.data.payrolls?t=a.data.payrolls.map(e=>({empleado:e.employeeName||"N/A",salarioBruto:e.grossSalary,salarioNeto:e.netSalary})):"employees"===a.type&&a.data.employees&&(t=a.data.employees.map(e=>({nombre:e.name,email:e.email,departamento:e.department||"N/A",estado:e.status}))),O(t,e),(0,y.oR)({title:"CSV exportado",description:"Los datos se han exportado correctamente"})}catch(e){console.error("Error exporting CSV:",e),(0,y.oR)({title:"Error",description:"Error al exportar el CSV",variant:"destructive"})}},[a]);return{isLoading:e,currentReport:a,generateReport:o,exportToPDF:n,exportToCSVFile:i,clearReport:()=>r(null)}},M=()=>{var e;let{user:t}=(0,g.A)(),{toast:a}=(0,y.dj)(),[v,f]=(0,s.useState)("overview"),[w,j]=(0,s.useState)(""),[D,N]=(0,s.useState)(""),{isLoading:E,currentReport:b,generateReport:S,exportToPDF:A,exportToCSVFile:k}=T(),R={canGenerateReports:(null==t?void 0:t.role)==="consultor"||(null==t?void 0:t.role)==="empresario",canExportReports:(null==t?void 0:t.role)==="consultor"||(null==t?void 0:t.role)==="empresario",canViewAllData:(null==t?void 0:t.role)==="consultor"||(null==t?void 0:t.role)==="empresario",canViewLimitedData:(null==t?void 0:t.role)==="empleado"||(null==t?void 0:t.role)==="gestor",isReadOnly:(null==t?void 0:t.role)==="empleado"||(null==t?void 0:t.role)==="gestor"},C=async()=>{if(!R.canGenerateReports)return void a({title:"Permisos insuficientes",description:"Solo Consultoras y Empresarios pueden generar reportes",variant:"destructive"});let e={companyId:"",startDate:new Date(w||Date.now()),endDate:new Date(D||Date.now())};await S(v,e)},I=[{value:"overview",label:"Resumen General",icon:l.A},{value:"attendance",label:"Asistencias",icon:o.A},{value:"payroll",label:"N\xf3minas",icon:n.A},{value:"employees",label:"Empleados",icon:i.A}];return(0,r.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:(null==t?void 0:t.role)==="consultor"?"Centro de Reportes":(null==t?void 0:t.role)==="empresario"?"Reportes de la Empresa":"Consulta de Reportes"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:(null==t?void 0:t.role)==="consultor"?"Genera y exporta reportes completos de todas las empresas":(null==t?void 0:t.role)==="empresario"?"Accede a reportes de tu empresa":"Consulta reportes b\xe1sicos disponibles"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,r.jsx)(x.E,{variant:(null==t?void 0:t.role)==="consultor"?"default":"secondary",children:(null==t?void 0:t.role)==="consultor"?"\uD83D\uDC69‍\uD83D\uDCBC Consultora - Acceso Completo":(null==t?void 0:t.role)==="empresario"?"\uD83C\uDFE2 Empresario - Reportes Empresariales":(null==t?void 0:t.role)==="empleado"?"\uD83D\uDC68‍\uD83D\uDCBB Empleado - Vista B\xe1sica":(null==t?void 0:t.role)==="gestor"?"\uD83D\uDC54 Gestor - Vista Limitada":"Usuario"}),R.isReadOnly&&(0,r.jsx)(x.E,{variant:"outline",className:"text-orange-600 border-orange-200",children:"\uD83D\uDC41️ Solo Consulta"})]})]})}),(0,r.jsxs)(u.Zp,{children:[(0,r.jsxs)(u.aR,{children:[(0,r.jsx)(u.ZB,{children:"Generar Reporte"}),(0,r.jsx)(u.BT,{children:"Selecciona el tipo de reporte y configura los filtros"})]}),(0,r.jsxs)(u.Wu,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p.J,{htmlFor:"report-type",children:"Tipo de Reporte"}),(0,r.jsxs)(h.l6,{value:v,onValueChange:e=>f(e),children:[(0,r.jsx)(h.bq,{children:(0,r.jsx)(h.yv,{placeholder:"Seleccionar tipo"})}),(0,r.jsx)(h.gC,{children:((null==t?void 0:t.role)==="consultor"||(null==t?void 0:t.role)==="empresario"?I:(null==t?void 0:t.role)==="empleado"||(null==t?void 0:t.role)==="gestor"?I.filter(e=>"overview"===e.value||"attendance"===e.value):[]).map(e=>(0,r.jsx)(h.eb,{value:e.value,children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(e.icon,{className:"h-4 w-4"}),(0,r.jsx)("span",{children:e.label})]})},e.value))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p.J,{htmlFor:"start-date",children:"Fecha Inicio"}),(0,r.jsx)(m.p,{id:"start-date",type:"date",value:w,onChange:e=>j(e.target.value)})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(p.J,{htmlFor:"end-date",children:"Fecha Fin"}),(0,r.jsx)(m.p,{id:"end-date",type:"date",value:D,onChange:e=>N(e.target.value)})]})]}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[R.canGenerateReports&&(0,r.jsx)(d.$,{onClick:C,disabled:E,children:E?"Generando...":"Generar Reporte"}),R.isReadOnly&&(0,r.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center",children:[(0,r.jsx)("span",{className:"mr-2",children:"ℹ️"}),"Contacta a tu Consultora o Empresario para generar reportes personalizados"]}),b&&R.canExportReports&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.$,{variant:"outline",onClick:()=>{if(!R.canExportReports)return void a({title:"Permisos insuficientes",description:"Solo Consultoras y Empresarios pueden exportar reportes",variant:"destructive"});A("report-content")},disabled:E,children:[(0,r.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Exportar PDF"]}),(0,r.jsxs)(d.$,{variant:"outline",onClick:()=>{if(!R.canExportReports)return void a({title:"Permisos insuficientes",description:"Solo Consultoras y Empresarios pueden exportar reportes",variant:"destructive"});k()},disabled:E,children:[(0,r.jsx)(c.A,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]})]})]})]})]}),b&&(0,r.jsx)("div",{id:"report-content",children:(0,r.jsxs)(u.Zp,{children:[(0,r.jsx)(u.aR,{children:(0,r.jsxs)(u.ZB,{className:"flex items-center justify-between",children:[(0,r.jsxs)("span",{children:["Reporte: ",null==(e=I.find(e=>e.value===b.type))?void 0:e.label]}),(0,r.jsx)(x.E,{variant:"outline",children:b.generatedAt.toLocaleDateString()})]})}),(0,r.jsx)(u.Wu,{children:(0,r.jsx)(P,{report:b})})]})})]})},P=e=>{var t,a,s,l,c,d;let{report:p}=e,{type:m,data:h}=p;switch(m){case"overview":return(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsx)(u.Zp,{children:(0,r.jsx)(u.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(i.A,{className:"h-5 w-5 text-blue-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Empleados Totales"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:(null==(t=h.overview)?void 0:t.totalEmployees)||0})]})]})})}),(0,r.jsx)(u.Zp,{children:(0,r.jsx)(u.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(o.A,{className:"h-5 w-5 text-green-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Asistencias"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:(null==(a=h.overview)?void 0:a.totalAttendances)||0})]})]})})}),(0,r.jsx)(u.Zp,{children:(0,r.jsx)(u.Wu,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(n.A,{className:"h-5 w-5 text-yellow-500"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"N\xf3mina Total"}),(0,r.jsxs)("p",{className:"text-2xl font-bold",children:["$",(null==(l=h.overview)||null==(s=l.totalPayroll)?void 0:s.toFixed(2))||"0.00"]})]})]})})})]})});case"attendance":return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Registro de Asistencias"}),(0,r.jsxs)("p",{children:["Total de registros: ",h.totalRecords||0]}),(0,r.jsx)("div",{className:"text-sm text-muted-foreground",children:"Datos de asistencia para el per\xedodo seleccionado"})]});case"payroll":return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Reporte de N\xf3minas"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Salario Bruto Total"}),(0,r.jsxs)("p",{className:"text-xl font-bold",children:["$",(null==(c=h.totalGross)?void 0:c.toFixed(2))||"0.00"]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Salario Neto Total"}),(0,r.jsxs)("p",{className:"text-xl font-bold",children:["$",(null==(d=h.totalNet)?void 0:d.toFixed(2))||"0.00"]})]})]})]});case"employees":return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold",children:"Reporte de Empleados"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total de Empleados"}),(0,r.jsx)("p",{className:"text-xl font-bold",children:h.totalEmployees||0})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Empleados Activos"}),(0,r.jsx)("p",{className:"text-xl font-bold",children:h.activeEmployees||0})]})]})]});default:return(0,r.jsx)("p",{children:"Tipo de reporte no reconocido"})}},L=()=>(0,r.jsx)(v.O,{allowedRoles:["empresario","gestor","consultor"],children:(0,r.jsx)(M,{})})},62387:(e,t,a)=>{"use strict";a.d(t,{uc:()=>l});var r=a(35317),s=a(9086);let l=async e=>await (0,s.Gz)("EMPLOYEES",[(0,r._M)("companyId","==",e),(0,r.My)("createdAt","desc")])},63689:(e,t,a)=>{Promise.resolve().then(a.bind(a,57460))},85053:(e,t,a)=>{"use strict";a.d(t,{Be:()=>d,b$:()=>i,c1:()=>h,eN:()=>u,i9:()=>c,is:()=>n,n8:()=>x,p5:()=>p,sS:()=>m,vY:()=>v});var r=a(35317),s=a(9086);let l=(e,t,a,s)=>{if(!e||!t)return 0;let l=e instanceof r.Dc?e.toDate():e,o=((t instanceof r.Dc?t.toDate():t).getTime()-l.getTime())/6e4;if(a&&s){let e=a instanceof r.Dc?a.toDate():a;o-=((s instanceof r.Dc?s.toDate():s).getTime()-e.getTime())/6e4}return Math.max(0,o/60)},o=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"09:00";if(!e)return"absent";let s=e instanceof r.Dc?e.toDate():e,[o,n]=a.split(":").map(Number),i=new Date(s);return(i.setHours(o,n,0,0),s.getTime()>i.getTime()+9e5)?"late":t?4>l(e,t)?"half_day":"present":4>l(e,new Date)?"half_day":"present"},n=async(e,t)=>{let a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate()),s=await m(e,r);if(s&&s.checkIn)throw Error("Ya has registrado tu entrada para hoy");let l=o(a);return s?(await p(s.id,{checkIn:a,status:l}),s.id):await u({employeeId:e,companyId:t,date:r,checkIn:a})},i=async(e,t)=>{let a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate()),s=await m(e,r);if(!s||!s.checkIn)throw Error("Debes registrar tu entrada primero");if(s.checkOut)throw Error("Ya has registrado tu salida para hoy");let n=l(s.checkIn,a,s.breakStart,s.breakEnd),i=o(s.checkIn,a);await p(s.id,{checkOut:a,totalHours:n,status:i})},c=async e=>{let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=await m(e,a);if(!r||!r.checkIn)throw Error("Debes registrar tu entrada primero");if(r.breakStart)throw Error("Ya has iniciado tu descanso");await p(r.id,{breakStart:t})},d=async e=>{let t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()),r=await m(e,a);if(!r||!r.breakStart)throw Error("Debes iniciar tu descanso primero");if(r.breakEnd)throw Error("Ya has terminado tu descanso");await p(r.id,{breakEnd:t})},u=async e=>{let t={...e,date:r.Dc.fromDate(e.date),checkIn:e.checkIn?r.Dc.fromDate(e.checkIn):void 0,checkOut:e.checkOut?r.Dc.fromDate(e.checkOut):void 0,breakStart:e.breakStart?r.Dc.fromDate(e.breakStart):void 0,breakEnd:e.breakEnd?r.Dc.fromDate(e.breakEnd):void 0,totalHours:l(e.checkIn,e.checkOut,e.breakStart,e.breakEnd),status:o(e.checkIn,e.checkOut)};return(await (0,s.ui)("ATTENDANCES",t)).id},p=async(e,t)=>{let a={...t};t.checkIn&&(a.checkIn=r.Dc.fromDate(t.checkIn)),t.checkOut&&(a.checkOut=r.Dc.fromDate(t.checkOut)),t.breakStart&&(a.breakStart=r.Dc.fromDate(t.breakStart)),t.breakEnd&&(a.breakEnd=r.Dc.fromDate(t.breakEnd)),await (0,s.lU)("ATTENDANCES",e,a)},m=async(e,t)=>{let a=r.Dc.fromDate(new Date(t.getFullYear(),t.getMonth(),t.getDate())),l=r.Dc.fromDate(new Date(t.getFullYear(),t.getMonth(),t.getDate()+1)),o=[(0,r._M)("employeeId","==",e),(0,r._M)("date",">=",a),(0,r._M)("date","<",l)],n=await (0,s.Gz)("ATTENDANCES",o);return n.length>0?n[0]:null},h=async(e,t,a)=>{let l=[(0,r._M)("employeeId","==",e)];return t&&l.push((0,r._M)("date",">=",r.Dc.fromDate(t))),a&&l.push((0,r._M)("date","<=",r.Dc.fromDate(a))),l.push((0,r.My)("date","desc")),await (0,s.Gz)("ATTENDANCES",l)},x=async(e,t,a)=>{let l=[(0,r._M)("companyId","==",e)];return t&&l.push((0,r._M)("date",">=",r.Dc.fromDate(t))),a&&l.push((0,r._M)("date","<=",r.Dc.fromDate(a))),l.push((0,r.My)("date","desc")),await (0,s.Gz)("ATTENDANCES",l)},v=async(e,t,a)=>{let r=await x(e,t,a);return{totalRecords:r.length,present:r.filter(e=>"present"===e.status).length,absent:r.filter(e=>"absent"===e.status).length,late:r.filter(e=>"late"===e.status).length,halfDay:r.filter(e=>"half_day"===e.status).length,holiday:r.filter(e=>"holiday"===e.status).length,averageHours:r.reduce((e,t)=>e+(t.totalHours||0),0)/r.length||0,totalHours:r.reduce((e,t)=>e+(t.totalHours||0),0)}}},85427:(e,t,a)=>{"use strict";a.d(t,{BB:()=>i,Dc:()=>l,Lo:()=>h,T4:()=>m,Tv:()=>p,ew:()=>d,hm:()=>n,iW:()=>x,iv:()=>o,rI:()=>u});var r=a(35317),s=a(9086);let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=t.reduce((e,t)=>e+t.amount,0),s=a.reduce((e,t)=>e+t.amount,0),l=e+r;return{totalBonuses:r,totalDeductions:s,totalGross:l,totalNet:l-s}},o=async e=>{let{totalGross:t,totalNet:a}=l(e.baseSalary,e.bonuses,e.deductions),r={...e,bonuses:e.bonuses||[],deductions:e.deductions||[],totalGross:t,totalNet:a,status:"draft"};return(await (0,s.ui)("PAYROLLS",r)).id},n=async(e,t)=>{let a={...t};if(void 0!==t.baseSalary||t.bonuses||t.deductions){let s=await c(e);if(s){var r,o,n;let e=null!=(r=t.baseSalary)?r:s.baseSalary,{totalGross:i,totalNet:c}=l(e,null!=(o=t.bonuses)?o:s.bonuses,null!=(n=t.deductions)?n:s.deductions);a={...a,totalGross:i,totalNet:c}}}await (0,s.lU)("PAYROLLS",e,a)},i=async e=>{await (0,s.Nn)("PAYROLLS",e)},c=async e=>await (0,s._L)("PAYROLLS",e),d=async e=>await (0,s.Gz)("PAYROLLS",[(0,r._M)("employeeId","==",e),(0,r.My)("createdAt","desc")]),u=async e=>await (0,s.Gz)("PAYROLLS",[(0,r._M)("companyId","==",e),(0,r.My)("createdAt","desc")]),p=async(e,t,a)=>await (0,s.Gz)("PAYROLLS",[(0,r._M)("companyId","==",e),(0,r._M)("period.month","==",t),(0,r._M)("period.year","==",a),(0,r.My)("createdAt","desc")]),m=async e=>{await n(e,{status:"approved"})},h=async e=>{await n(e,{status:"paid"})},x=async(e,t,a)=>{let r=await p(e,t,a);return{totalEmployees:r.length,totalGross:r.reduce((e,t)=>e+t.totalGross,0),totalNet:r.reduce((e,t)=>e+t.totalNet,0),totalDeductions:r.reduce((e,t)=>e+t.deductions.reduce((e,t)=>e+t.amount,0),0),totalBonuses:r.reduce((e,t)=>e+t.bonuses.reduce((e,t)=>e+t.amount,0),0),byStatus:{draft:r.filter(e=>"draft"===e.status).length,approved:r.filter(e=>"approved"===e.status).length,paid:r.filter(e=>"paid"===e.status).length}}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,3644,5033,3930,4316,4277,3909,9233,2001,7788,4999,3005,8615,8441,1684,7358],()=>t(63689)),_N_E=e.O()}]);